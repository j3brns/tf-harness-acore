# Checkov Configuration for Bedrock AgentCore Terraform
# https://www.checkov.io/

# Framework to scan
framework:
  - terraform

# Directories to scan
directory:
  - .

# Skip specific directories
skip-path:
  - .terraform
  - .git
  - node_modules
  - examples  # Example stacks are intentionally minimal
  - examples/3-deepresearch/agent-code  # Python code, not Terraform

# Output format
output:
  - cli
  - junitxml

# Compact output
compact: true

# Soft fail (don't exit non-zero) - set to false for CI
soft-fail: false

# Check IDs to skip (with justification)
skip-check:
  # CKV_AWS_144: S3 cross-region replication - single region design decision (ADR-0007)
  - CKV_AWS_144

  # CKV_AWS_145: S3 KMS encryption - using AWS-managed SSE-S3 (ADR-0008)
  - CKV_AWS_145

  # CKV_AWS_158: CloudWatch log group KMS - AWS-managed encryption is required (ADR-0008)
  - CKV_AWS_158

  # CKV_AWS_338: Log retention >= 1 year - default is 30 days unless overridden
  - CKV_AWS_338

  # CKV2_AWS_62: S3 event notifications - not required for deployment bucket
  - CKV2_AWS_62

  # CKV2_AWS_61: S3 lifecycle configuration - handled separately
  - CKV2_AWS_61

  # CKV_AWS_18: S3 access logging - not required for deployment artifact bucket
  - CKV_AWS_18

  # CKV_AWS_21: S3 versioning - enabled via separate resource (false positive in some scans)
  - CKV_AWS_21

  # CKV2_AWS_6: S3 public access block - enforced via aws_s3_bucket_public_access_block
  - CKV2_AWS_6

  # CKV_AWS_111: IAM policy should not allow * resource - many bedrock/ec2 actions require this (documented)
  - CKV_AWS_111

  # CKV_AWS_356: IAM policy should not allow full access - used for cross-account/service assumption
  - CKV_AWS_356

  # CKV_AWS_107, 108, 109, 110: Bedrock/STS actions sometimes flagged as high risk
  - CKV_AWS_107
  - CKV_AWS_108
  - CKV_AWS_109
  - CKV_AWS_110

# Download external modules for scanning
download-external-modules: false

# Evaluate variables
evaluate-variables: true

# Enable secrets scanning
enable-secret-scan-all-files: true

# Block list for secrets (patterns to flag)
block-list-secret-scan:
  - "aws_access_key_id"
  - "aws_secret_access_key"
  - "password"
  - "secret"
  - "token"
  - "api_key"

# Summary position
summary-position: bottom
